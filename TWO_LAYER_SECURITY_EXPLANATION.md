# 2螻､繧ｻ繧ｭ繝･繝ｪ繝・ぅ縺ｮ隱ｬ譏・

## 蝠城｡・

迴ｾ蝨ｨ縲，loud Run繧ｵ繝ｼ繝薙せ閾ｪ菴薙∈縺ｮ繧｢繧ｯ繧ｻ繧ｹ縺瑚ｨｱ蜿ｯ縺輔ｌ縺ｦ縺・↑縺・◆繧√・03繧ｨ繝ｩ繝ｼ縺檎匱逕溘＠縺ｦ縺・∪縺吶・

## 隗｣豎ｺ遲厄ｼ・螻､繧ｻ繧ｭ繝･繝ｪ繝・ぅ

### 隨ｬ1螻､・咾loud Run繧ｵ繝ｼ繝薙せ縺ｸ縺ｮ繧｢繧ｯ繧ｻ繧ｹ・亥ｿ・ｦ・ｼ・

**`allUsers`縺ｸ縺ｮ蜈ｬ髢九い繧ｯ繧ｻ繧ｹ繧定ｨｱ蜿ｯ縺吶ｋ蠢・ｦ√′縺ゅｊ縺ｾ縺吶・*

縺薙ｌ縺ｯ縲，loud Run繧ｵ繝ｼ繝薙せ閾ｪ菴薙∈縺ｮ繧｢繧ｯ繧ｻ繧ｹ繧定ｨｱ蜿ｯ縺吶ｋ繧ゅ・縺ｧ縲・*繧｢繝励Μ繧ｱ繝ｼ繧ｷ繝ｧ繝ｳ縺ｮ讖溯・縺ｫ縺ｯ繧｢繧ｯ繧ｻ繧ｹ縺ｧ縺阪∪縺帙ｓ**縲・

### 隨ｬ2螻､・壹い繝励Μ繧ｱ繝ｼ繧ｷ繝ｧ繝ｳ繝ｬ繝吶Ν縺ｮ隱崎ｨｼ・亥ｮ溯｣・ｸ医∩・・

**API繧ｭ繝ｼ隱崎ｨｼ縺ｧ菫晁ｭｷ縺輔ｌ縺ｦ縺・∪縺吶・*

API繧ｭ繝ｼ縺後↑縺・→縲∝ｮ滄圀縺ｮAPI繧ｨ繝ｳ繝峨・繧､繝ｳ繝茨ｼ・/api/gemini`縺ｪ縺ｩ・峨・菴ｿ逕ｨ縺ｧ縺阪∪縺帙ｓ縲・

## 繧ｻ繧ｭ繝･繝ｪ繝・ぅ荳翫・蛻ｩ轤ｹ

1. **隱ｰ縺ｧ繧・loud Run繧ｵ繝ｼ繝薙せ縺ｫ繧｢繧ｯ繧ｻ繧ｹ縺ｧ縺阪ｋ**
   - 縺励°縺励、PI繧ｭ繝ｼ縺後↑縺・→螳滄圀縺ｮAPI縺ｯ菴ｿ逕ｨ縺ｧ縺阪↑縺・
   - 蜈ｬ髢九お繝ｳ繝峨・繧､繝ｳ繝茨ｼ・/`縲～/health`・峨・縺ｿ繧｢繧ｯ繧ｻ繧ｹ蜿ｯ閭ｽ

2. **API繧ｭ繝ｼ縺ｧ菫晁ｭｷ**
   - 縺吶∋縺ｦ縺ｮAPI繧ｨ繝ｳ繝峨・繧､繝ｳ繝茨ｼ・/api/gemini`縲～/api/analyze`縺ｪ縺ｩ・峨・隱崎ｨｼ縺悟ｿ・ｦ・
   - API繧ｭ繝ｼ縺後↑縺・→縲・01繧ｨ繝ｩ繝ｼ縺瑚ｿ斐＆繧後ｋ

3. **Secret Manager縺ｧ邂｡逅・*
   - API繧ｭ繝ｼ縺ｯSecret Manager縺ｧ螳牙・縺ｫ邂｡逅・
   - 蠢・ｦ√↓蠢懊§縺ｦ縲、PI繧ｭ繝ｼ繧偵Ο繝ｼ繝・・繧ｷ繝ｧ繝ｳ蜿ｯ閭ｽ

## 險ｭ螳壽婿豕・

### Google Cloud Console縺九ｉ險ｭ螳夲ｼ域耳螂ｨ・・

1. 莉･荳九・URL縺ｫ繧｢繧ｯ繧ｻ繧ｹ・・
   ```
   https://console.cloud.google.com/run/detail/asia-northeast1/ai-drbfm-backend/permissions?project=tamron-cloudrun-prod-new
   ```

2. 縲後・繝ｪ繝ｳ繧ｷ繝代Ν繧定ｿｽ蜉縲阪ｒ繧ｯ繝ｪ繝・け

3. 莉･荳九ｒ蜈･蜉幢ｼ・
   - **譁ｰ縺励＞繝励Μ繝ｳ繧ｷ繝代Ν**: `allUsers`
   - **繝ｭ繝ｼ繝ｫ**: `Cloud Run 襍ｷ蜍募・` 縺ｾ縺溘・ `roles/run.invoker`

4. 縲御ｿ晏ｭ倥阪ｒ繧ｯ繝ｪ繝・け

### 險ｭ螳壼ｾ後・蜍穂ｽ・

- 笨・隱ｰ縺ｧ繧・loud Run繧ｵ繝ｼ繝薙せ縺ｫ繧｢繧ｯ繧ｻ繧ｹ蜿ｯ閭ｽ・・/`縲～/health`繧ｨ繝ｳ繝峨・繧､繝ｳ繝茨ｼ・
- 笨・API繧ｭ繝ｼ縺後↑縺・→縲～/api/gemini`縺ｪ縺ｩ縺ｮAPI繧ｨ繝ｳ繝峨・繧､繝ｳ繝医・菴ｿ逕ｨ荳榊庄・・01繧ｨ繝ｩ繝ｼ・・
- 笨・API繧ｭ繝ｼ縺後≠繧句ｴ蜷医・縺ｿ縲、PI繧ｨ繝ｳ繝峨・繧､繝ｳ繝医′菴ｿ逕ｨ蜿ｯ閭ｽ

## 繧ｻ繧ｭ繝･繝ｪ繝・ぅ荳翫・諛ｸ蠢ｵ縺ｸ縺ｮ蟇ｾ蠢・

### Q: `allUsers`縺ｫ縺吶ｋ縺ｨ繧ｻ繧ｭ繝･繝ｪ繝・ぅ縺悟ｿ・・

**A: 蝠城｡後≠繧翫∪縺帙ｓ縲ら炊逕ｱ・・*

1. **繧｢繝励Μ繧ｱ繝ｼ繧ｷ繝ｧ繝ｳ繝ｬ繝吶Ν縺ｮ隱崎ｨｼ縺ｧ菫晁ｭｷ**
   - API繧ｭ繝ｼ縺後↑縺・→縲∝ｮ滄圀縺ｮAPI縺ｯ菴ｿ逕ｨ縺ｧ縺阪↑縺・
   - 蜈ｬ髢九お繝ｳ繝峨・繧､繝ｳ繝茨ｼ・/`縲～/health`・峨・縺ｿ繧｢繧ｯ繧ｻ繧ｹ蜿ｯ閭ｽ

2. **API繧ｭ繝ｼ縺ｯSecret Manager縺ｧ邂｡逅・*
   - API繧ｭ繝ｼ縺ｯSecret Manager縺ｧ螳牙・縺ｫ邂｡逅・
   - 蠢・ｦ√↓蠢懊§縺ｦ縲、PI繧ｭ繝ｼ繧偵Ο繝ｼ繝・・繧ｷ繝ｧ繝ｳ蜿ｯ閭ｽ

3. **繝ｬ繝ｼ繝亥宛髯舌・霑ｽ蜉繧ょ庄閭ｽ**
   - 蠢・ｦ√↓蠢懊§縺ｦ縲√Ξ繝ｼ繝亥宛髯舌ｒ霑ｽ蜉縺励※縲・℃蠎ｦ縺ｪ繧｢繧ｯ繧ｻ繧ｹ繧帝亟豁｢

### 繧医ｊ螳牙・縺ｫ縺吶ｋ譁ｹ豕・

1. **CORS險ｭ螳壹ｒ迚ｹ螳壹・繝峨Γ繧､繝ｳ縺ｫ蛻ｶ髯・*
   - 迚ｹ螳壹・繝峨Γ繧､繝ｳ縺九ｉ縺ｮ繧｢繧ｯ繧ｻ繧ｹ縺ｮ縺ｿ險ｱ蜿ｯ

2. **繝ｬ繝ｼ繝亥宛髯舌・霑ｽ蜉**
   - 驕主ｺｦ縺ｪ繧｢繧ｯ繧ｻ繧ｹ繧帝亟豁｢

3. **IP繧｢繝峨Ξ繧ｹ蛻ｶ髯・*
   - 迚ｹ螳壹・IP繧｢繝峨Ξ繧ｹ縺九ｉ縺ｮ繧｢繧ｯ繧ｻ繧ｹ縺ｮ縺ｿ險ｱ蜿ｯ・医◆縺縺励√ヵ繝ｭ繝ｳ繝医お繝ｳ繝峨′隍・焚縺ｮ蝣ｴ謇縺九ｉ繧｢繧ｯ繧ｻ繧ｹ縺吶ｋ蝣ｴ蜷医・蝗ｰ髮｣・・

## 邨占ｫ・

**`allUsers`縺ｸ縺ｮ蜈ｬ髢九い繧ｯ繧ｻ繧ｹ繧定ｨｱ蜿ｯ縺励※繧ゅ、PI繧ｭ繝ｼ隱崎ｨｼ縺ｧ菫晁ｭｷ縺輔ｌ縺ｦ縺・ｋ縺溘ａ縲√そ繧ｭ繝･繝ｪ繝・ぅ縺ｯ遒ｺ菫昴＆繧後※縺・∪縺吶・*

縺薙ｌ縺ｯ縲∝､壹￥縺ｮWeb API縺ｧ菴ｿ逕ｨ縺輔ｌ縺ｦ縺・ｋ荳闊ｬ逧・↑繧ｻ繧ｭ繝･繝ｪ繝・ぅ繝｢繝・Ν縺ｧ縺吶・
